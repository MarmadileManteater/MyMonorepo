---
import './blog-post-list.less'
import type { BlogPost } from '@marmadilemanteater/dataservice/blog-posts'
import { If, Foreach } from '@marmadilemanteater/astro-logic-components'
import TagList from '../tag-list/tag-list.astro'
import type { Tag } from '@marmadilemanteater/dataservice/tags'
import { formatLongDate, formatShortDate } from '../../helpers'
import Emoji from '../emoji.astro'
import type { HTMLAttributes } from 'astro/types'

interface Props extends HTMLAttributes<'section'> {
  posts: BlogPost[],
  tags: Tag[],
  class: string|undefined
}

const { posts, tags, ...rest }: Props = Astro.props
// this is to prevent duplicate `class` attributes
delete rest['class']
---
<section 
  {...rest}
  class={`blog-post-list ${Astro.props.class || ''}`}
>
  <slot name='top' />
  <Foreach
    list={posts}
  >
    {(post: BlogPost, i: number) => {
      const postTags = tags.filter(({name} : Tag) => post.tags.indexOf(name) !== -1)
      const date = new Date(post.gitDate)
      const shortDate = formatShortDate(date)
      const longDate = formatLongDate(date)
      return <article
        data-even={i % 2 === 0 ? 'true' : 'false'}
      >
        <If condition={postTags.length > 0} >
          <TagList tags={postTags} />
        </If>
        <h1><a href={`/blog/${post.id}`}><Emoji>{post.title}</Emoji></a></h1>
        <summary><Emoji>{post.shortDescription}</Emoji></summary>
        <p class='date-text'><em>Last updated: <time datetime={shortDate}>{longDate}</time></em></p>
      </article>
    }}
  </Foreach>
</section>
