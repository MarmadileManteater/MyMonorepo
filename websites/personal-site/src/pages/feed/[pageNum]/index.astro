---
import { getSocialPosts, getSocialFeedLength } from '@marmadilemanteater/dataservice/social-posts'
import SocialPostList from '../../../components/social-post-list/social-post-list.astro'
import MasterTemplate from '../../../layouts/master.astro'
import Pagination from '../../../components/pagination/pagination.astro'

export const PAGE_LENGTH = 10
export const TOTAL_LENGTH: number = await getSocialFeedLength()
export const PAGE_NUMS: Array<number> = Array.from(Array(Math.ceil(TOTAL_LENGTH / PAGE_LENGTH)).keys())

export function getStaticPaths() {
  return PAGE_NUMS.map((_,pageNum) => {
    return { 
      params: {
        pageNum: `${pageNum}`
      }
    }
  })
}

const { pageNum } = Astro.params
const num = parseInt(pageNum)
const socialPosts = await getSocialPosts(num * PAGE_LENGTH, (num + 1) * PAGE_LENGTH, `${Astro.url.protocol}//${Astro.url.host}/`)
---

<MasterTemplate title="Social Feed">
  <SocialPostList {socialPosts} />
  
  <Pagination pageNums={PAGE_NUMS} currentPage={num} baseLink='/feed' />
</MasterTemplate>

