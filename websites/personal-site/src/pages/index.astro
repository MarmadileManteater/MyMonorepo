---
import MasterTemplate from '../layouts/master.astro'
import ProjectList, { getProjectsSort } from '../components/project-list.astro'
import Links from '../components/links.astro'
import { allLinks } from '../dataservice'
import { allTags, projectsRepository } from '../dataservice'
import Emoji from '../components/emoji.astro'
// @ts-ignore
import portrait from '../../../../packages/static-data/public/images/portrait.jpg?w=142&h=190&format=webp'

const { getAllProjects } = projectsRepository
const projects = await getAllProjects()
// #region get first of every sort type with no duplicates
const firstFeatured = projects[0]
projects.sort(getProjectsSort('updated'))
let index = 0
while (projects[index] === firstFeatured) {
  index++
}
const firstUpdated = projects[index]
projects.sort(getProjectsSort('stars'))
index = 0
while (projects[index] === firstFeatured || projects[index] === firstUpdated) {
  index++
}
const firstStars = projects[index]
// #endregion
---

<MasterTemplate title='MarmadileManteater'>
  <section class='info-and-links'>
    <section class='info'>
      <div class='wrapper'>
        <div class='portrait'>
          <img 
            src={portrait}
            alt='a young woman with dyed red hair in a dress (also known as me)'
          />
        </div>
        <summary>
          Hello! I'm MarmadileManteater. My real name is Emma, and you can look it up. That's an actual picture of me!
          <address>
            <a href='https://matrix.to/#/@marmadilemanteater:matrix.org'><Emoji emoji='ðŸ’¬' /> Message me</a> |
            <a href='mailto:marmadilemanteater@proton.me'><Emoji emoji='ðŸ“¬' /> Email me</a>
          </address>
        </summary>
      </div>
    </section>
    <Links links={allLinks} />
  </section>
  <ProjectList
    projects={[firstFeatured, firstUpdated, firstStars]}
    tags={allTags}
    class='break-on-mobile'
    startOffset={1}
  />
  <footer>
    <a href="/projects">View more &raquo;</a>
  </footer>
</MasterTemplate>
<style lang='less' is:global>
  @import url(../variables.less);
  .info {
    border-radius: 1em;
    overflow: hidden;
    background-color: @bg-light-1;
    @media (prefers-color-scheme: dark) {
      background-color: @bg-dark-2;
    }
    @media (max-width: @md-breakpoint) {
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      @media (prefers-color-scheme: dark) {
        background-color: @bg-dark-2;
      }
    }
  }
  section.info-and-links {
    display: flex;
    justify-content: center;
    gap: 1em;
    margin-bottom: 1em;
    @media (max-width: @md-breakpoint) {
      display: block;
      margin-bottom: 0;
    }
  }
  section.info-and-links .info {
    max-width: 50%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    @media (max-width: @md-breakpoint) {
      max-width: 100%;
    }
  }
  section.info-and-links .info .wrapper {
    display: flex;
    gap: 1em;
    padding: 1em;
    @media (max-width: @sm-breakpoint) {
      flex-direction: column;
    }
  }
  section.info-and-links .info .wrapper .portrait {
    @media (max-width: @sm-breakpoint) {
      text-align: center;
    }
  }
  section.info-and-links .info .wrapper .portrait img {
    @media (max-width: @md-breakpoint) {
      width: 88px;
    }
    @media (max-width: @sm-breakpoint) {
      width: 124px;
    }
  }
  section.info-and-links .info summary {
    @media (max-width: @md-breakpoint) {
      font-size: 1.2em;
    }
  }
  section.info-and-links .info summary address {
    margin-top: 1.5em;
    display: flex;
    gap: 1em;
    @media (max-width: @lg-breakpoint) {
      flex-direction: column;
      font-size: 0;
      margin-top: 1.5rem;
    }
    @media (max-width: @md-breakpoint) {
      flex-direction: row;
      font-size: 1em;
      margin-top: 1.5em;
    }
    @media (max-width: @sm-breakpoint) {
      margin-top: 1em;
    }
  }
  section.info-and-links .info summary address a {
    position: relative;
    @media (max-width: @lg-breakpoint) {
      font-size: 1.1rem;
      margin-top: 0.25em;
      margin-bottom: 0.25em;
    }
    @media (max-width: @md-breakpoint) {
      font-size: 1em;
      margin-top: 0em;
      margin-bottom: 0em;
    }
  }
</style>
